---
title: "Final Project"
author: "Sanyukta Ghai"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  html_document:
    toc: true    
    toc_depth: 2    
    toc_float: TRUE
---

```{r echo = FALSE}
# Course: BUAN 5210
# Title: Quick Project 1 Technical Appendix
# Purpose: Analyzing office sales data 
# Date: Jan 26, 2019
# Author: Nancy Jain and Sanyukta Ghai
```


Clear environment
=================

```{r, warning= FALSE, message= FALSE}
# Clear environment of variables and functions
rm(list = ls(all = TRUE)) 
# Clear environmet of packages
if(is.null(sessionInfo()$otherPkgs) == FALSE)lapply(paste("package:", names(sessionInfo()$otherPkgs), sep=""), detach, character.only = TRUE, unload = TRUE)
```


Load packages 
==============

```{r, warning= FALSE, message= FALSE }
# Load libraries
library(tidyverse) # tidyverse syntax
library(ggplot2) # Neat Graphs 
library(kableExtra) # Pretty HTML Tables
library(corrplot) # Pairwise correlation plot
library(gridExtra) # Arrange graphs in a grid
library(janitor) # Pretty cross-tabs
```


Load data
=========================================
This dataset contains a list of video games with sales greater than 100,000 copies and is obtained from kaggle.com. It represents video games sales from a website vgchartz.com from 1980 to 2016.

```{r}
#Load Data
video_games_raw_data <- read.csv("../raw_data/vgsales.csv")

str(video_games_raw_data)

summary(video_games_raw_data)

```
### Observations

+ Table contains 16598 observations of 11 variables  
+ 5 factor variables - Name, Platform, Year, Genre, Publisher  
+ 6 numeric variables - Rank, NA_Sales, EU_Sales, JP_Sales, Other_Sales, Global_Sales

### Filter data based on our scope

```{r}
# Years from 2006 onwards
# Remove Rank column
# Consider only US Sales  
# Remove rows with 0 sales
# Pick top 200 games
video_games_data <- video_games_raw_data %>%
  select(-c(Rank, EU_Sales, JP_Sales, Other_Sales, Global_Sales)) %>%
  filter(Year %in% seq(2006, 2016, by = 1)) %>%
  mutate(Year = Year %>% droplevels()) %>%
  filter(NA_Sales > 0.000) %>%
  filter(!Publisher %in% c("NA", "N/A", "Unknown")) %>%
  top_n(200, NA_Sales) %>%
  mutate(Year = Year %>% droplevels()) %>%
  mutate(Platform = Platform %>% droplevels()) %>%
  mutate(Name = Name %>% droplevels()) %>%
  mutate(Publisher = Publisher %>% droplevels()) %>%
  mutate(Genre = Genre %>% droplevels())
  
str(video_games_data)

summary(video_games_data)

```

### Observations

+ 5 factor variables - Name, Platform, Year, Genre, Publisher  
+ 1 numeric variable - NA_Sales


Questions to be answered
========================
Company A want to know the feasibility of an online game streaming platform similar to ‘Netflix’ for games. They would like to know how to design their initial portfolio on the platform to generate maximum revenue.  

+ Should Company A tie up with a single publisher or platform?  
+ Which 3 top performing games should they include in their portfolio  
+ How should their portfolio split be in terms of game genres

Functions
==========

```{r, warning= FALSE, message= FALSE }
# Function to get the relevant grouped data frames
# df -> dataframe
# groupVariable -> the group by column 
# output -> the resulting data frame
getGroupedUnivariateData <- function(df, groupVariable) {
  # group_by() store
  # summarise() reduces variable to descriptive stat
  # count is the new variable name, n() is a counting function
  # percent is a new variable, sum() and nrow() are functions
  # tot_sales_units -> total number of units sold per store
  # tot_revenue -> total revenue per store
  # order_by() tot_revenue and tot_sales_units
  result <- df %>%             
    group_by_(groupVariable) %>%     
    summarise(count = n(),   
              percent = (sum(count) / nrow(df)) * 100, 
              tot_revenue = sum(NA_Sales),   
              avg_revenue = (mean(NA_Sales))) %>%
    arrange(desc(tot_revenue)) %>%
    as.data.frame() 
  
  return(result)
}

# Function to draw histograms using grid.arrange so can see all quant variables together group by variable x
# df -> dataframe
# x -> the group by column 
getGroupedUnivariateHistograms <- function(df, x, flip = TRUE) {
  grid.arrange(
    df %>% 
      ggplot(aes(x = get(x), y = count)) +  
        geom_bar(stat = "identity") + 
        {if(flip)coord_flip()} +
        xlab(x),
    df %>% 
      ggplot(aes(x = get(x), y = tot_revenue)) +
        geom_bar(stat = "identity") + 
        {if(flip)coord_flip()} +
        xlab(x),
    df %>% 
      ggplot(aes(x = get(x), y = avg_revenue)) +
        geom_bar(stat = "identity") + 
        {if(flip)coord_flip()} +
        xlab(x),
    ncol = 2
  )
}


```

# I) Practical Analysis

1. Univariate non-graphical -- Categorical
===========================================

Categorical data - tabulation

### Platform

```{r, warning= FALSE, message= FALSE}
# Count and revenue by Platform
vg_platform <- getGroupedUnivariateData(video_games_data, "Platform")
vg_platform %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  scroll_box(height = "300px")
```
### Observations

+ Top 5 Platforms by Total Revenue are X360, Wii, PS3, DS, XOne
+ Maximum number of games on X360(69) and PS3(37)  
+ X360, Wii and PS3 make up to 70% of the total games

### Year

```{r, warning= FALSE, message= FALSE}
# Count and revenue by Year
vg_year <- getGroupedUnivariateData(video_games_data, "Year")
vg_year %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  scroll_box(height = "300px")
```
### Observations

+ Top Years by Revenue are 2010, 2009, 2006
+ Maximum number of games launched between 2007 to 2011

### Genre

```{r, warning= FALSE, message= FALSE}
# Count and revenue by Genre
vg_genre <- getGroupedUnivariateData(video_games_data, "Genre")
vg_genre %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  scroll_box(height = "300px")
```
### Observations

+ Top 3 Genres are Shooter, Sports, Action
+ The top 3 Genres have more than 60% of the total games

### Publisher 

```{r, warning= FALSE, message= FALSE}
# Count and revenue by Publisher
vg_publisher <- getGroupedUnivariateData(video_games_data, "Publisher")
vg_publisher %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  scroll_box(height = "300px")
```
### Observations

+ Top 5 Publishers are Nintendo, Activision, Microsoft Game Studios, Electronic Arts, Take-Two Interactive   
+ Nintendo and Activision have highest total revenue  
+ Nintendo has maximum average revenue followed by Activision and Microsoft Game Studios


2. Univariate graphical -- Categorical
===========================================

Histograms

### Platform

```{r, warning= FALSE, message= FALSE }

# Revenue by Platform
getGroupedUnivariateHistograms(vg_platform, "Platform")

```
### Observations

+ X360 has maximum games  
+ X360 has maximum total revenue  
+ Wii has maximum average revenue

### Year

```{r, warning= FALSE, message= FALSE }

# Revenue by Year
getGroupedUnivariateHistograms(vg_year, "Year")

```

### Observations

+ Most games were released between 2006 to 2011 with 2010 being maximum  
+ Total Revenue is maximum in year 2010
+ Maximum average revenue was in 2006


### Genre

```{r, warning= FALSE, message= FALSE }

# Revenue by Genre
getGroupedUnivariateHistograms(vg_genre, "Genre")

```
### Observations

+ Action & Shooter Genre have the most number of games  
+ Shooter Genre has maximum total revenue   
+ Racing Genre has maximum average revenue


### Publisher

```{r, warning= FALSE, message= FALSE }

# Revenue by Publisher
getGroupedUnivariateHistograms(vg_publisher, "Publisher")

```
### Observations

+ Nintendo followed by Activision in total games and revenue  
+ Nintendo followed by Microsoft Game Studios in average revenue


3. Univariate non-graphical -- Quantitative
============================================

Descriptive Statistics

```{r, warning=FALSE, message=FALSE}

# Get descriptive stats 
summary(video_games_data)

```

### Observations

+ Mean NA_Sales Revenue is 3.8 Millions  
+ Median NA_Sales is 2.65 Millions  
+ Therefore, the distribution is left skewed  
+ Maximum NA_Sales in 41.49 Million


4. Univariate graphical -- Quantitative
=========================================

Histograms

```{r, warning=FALSE, message=FALSE}
# Code histograms using ggplot() 
video_games_data %>% 
  ggplot(aes(NA_Sales)) +
  geom_histogram()

video_games_data %>% 
  ggplot(aes(NA_Sales)) +
  geom_histogram() +
  xlim(0,15)
```
### Observations

+ Most NA_Sales between 2 to 10 Million Dollars  
+ Few outliers around 40 Million Dollars

Boxplots

```{r, warning=FALSE, message=FALSE}
# Code boxplot
boxplot(video_games_data$NA_Sales, main = "NA_Sales(Millions")

```

### Observations same as histograms

5. Multivariate non-graphical -- Categorical
============================================

Cross-Tabs

```{r, warning= FALSE, message= FALSE }

# Make cross-tabs between two categorical variables using janitor package
video_games_data %>% 
  tabyl(Platform, Publisher) %>% 
  adorn_totals(where = c("row", "col")) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"))# %>%
  #scroll_box(height = "300px")

```

### Observations

+ Nintendo has most games for their own platform DS and few games for Wii  
+ Activision and Electronic Arts create games for all platforms  

```{r, warning= FALSE, message= FALSE }

video_games_data %>% 
  tabyl(Publisher, Genre) %>% 
  adorn_totals(where = c("row", "col")) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) #%>%
  #scroll_box(height = "300px")
```

### Observations

+ Activision has the most shooter games (22)  
+ Take-Two Interactive and Ubisoft have the most action games (9)  
+ Electronic Arts have the most Sports games (16)  


```{r, warning= FALSE, message= FALSE }

video_games_data %>% 
  tabyl(Genre, Platform) %>% 
  adorn_totals(where = c("row", "col")) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) #%>%
  #scroll_box(height = "300px")
```

### Observations

+ X360 has the most shooter games (22)  
+ X360 and PS3 have the most action games (16, 15)  
+ X360 has the most Sports games (11)  

Proportion Cross-Tabs


```{r, warning= FALSE, message= FALSE }

# Make cross-tabs between two categorical variables using janitor package
video_games_data %>% 
  tabyl(Platform, Publisher) %>% 
  adorn_totals(where = c("row", "col")) %>%
  adorn_percentages() %>%
  adorn_pct_formatting() %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"))# %>%
  #scroll_box(height = "300px")

```

### Observations

+ Nintendo has most games for their own platform DS and few games for Wii  
+ Activision and Electronic Arts create games for all platforms  

```{r, warning= FALSE, message= FALSE }

video_games_data %>% 
  tabyl(Publisher, Genre) %>% 
  adorn_totals(where = c("row", "col")) %>%
  adorn_percentages() %>%
  adorn_pct_formatting() %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) #%>%
  #scroll_box(height = "300px")
```

### Observations

+ Activision has the most shooter games (22)  
+ Take-Two Interactive and Ubisoft have the most action games (9)  
+ Electronic Arts have the most Sports games (16)  


```{r, warning= FALSE, message= FALSE }

video_games_data %>% 
  tabyl(Genre, Platform) %>% 
  adorn_totals(where = c("row", "col")) %>%
  adorn_percentages() %>%
  adorn_pct_formatting() %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) #%>%
  #scroll_box(height = "300px")
```

### Observations

+ X360 has the most shooter games (22)  
+ X360 and PS3 have the most action games (16, 15)  
+ X360 has the most Sports games (11)  

6. Multivariate graphical code -- Categorical
==============================================

Grouped Summary graphs with more than 1 Categorical variables



7. Multivariate non-graphical -- Quantitative
==============================================

Correlation plots


8. Multivariate graphical code -- Quantitative
===============================================

Pairwise Plot



9. Multivariate non-graphical -- Categorical and Quantitative
=============================================================

matrix tables


10. Multivariate graphical -- Categorical and Quantitative
=============================================================

matrix group by and summarize quant graphs


# II) Statistical Analysis


Questions for statistical analysis
=========================================



Multiple Linear regression
================================

Summary
=======


Save Image of file
===================

```{r, warning= FALSE, message= FALSE }

# Save the rds file to reuse anything from this file in another file
save.image("TA.RData")
# recover using load()
# load("TA.RData")

```





