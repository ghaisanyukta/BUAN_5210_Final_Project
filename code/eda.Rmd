---
title: "Final Project"
author: "Sanyukta Ghai"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  html_document:
    toc: true    
    toc_depth: 2    
    toc_float: TRUE
---

```{r echo = FALSE}
# Course: BUAN 5210
# Title: Quick Project 1 Technical Appendix
# Purpose: Analyzing office sales data 
# Date: Jan 26, 2019
# Author: Nancy Jain and Sanyukta Ghai
```


Clear environment
=================

```{r, warning= FALSE, message= FALSE}
# Clear environment of variables and functions
rm(list = ls(all = TRUE)) 
# Clear environmet of packages
if(is.null(sessionInfo()$otherPkgs) == FALSE)lapply(paste("package:", names(sessionInfo()$otherPkgs), sep=""), detach, character.only = TRUE, unload = TRUE)
```


Load packages 
==============

```{r, warning= FALSE, message= FALSE }
# Load libraries
library(tidyverse) # tidyverse syntax
library(ggplot2) # Neat Graphs 
library(kableExtra) # Pretty HTML Tables
library(corrplot) # Pairwise correlation plot
library(gridExtra) # Arrange graphs in a grid
```


Load data
=========================================
This dataset contains a list of video games with sales greater than 100,000 copies and is obtained from kaggle.com. It represents video games sales from a website vgchartz.com from 1980 to 2016.

```{r}
#Load Data
video_games_raw_data <- read.csv("../raw_data/vgsales.csv")

str(video_games_raw_data)

summary(video_games_raw_data)

```
### Observations

+ Table contains 16598 observations of 11 variables  
+ 5 factor variables - Name, Platform, Year, Genre, Publisher  
+ 6 numeric variables - Rank, NA_Sales, EU_Sales, JP_Sales, Other_Sales, Global_Sales

### Filter data based on our scope

```{r}
# Years from 2000 onwards
# Remove Rank column
# Consider only US Sales  
# Remove rows with 0 sales
video_games_data <- video_games_raw_data %>%
  select(-c(Rank, EU_Sales, JP_Sales, Other_Sales, Global_Sales)) %>%
  filter(Year %in% seq(2000, 2016, by = 1)) %>%
  mutate(Year = Year %>% droplevels()) %>%
  filter(NA_Sales > 0.000) %>%
  filter(!Publisher %in% c("NA", "N/A", "Unknown"))

str(video_games_data)

summary(video_games_data)

```

### Observations

+ 5 factor variables - Name, Platform, Year, Genre, Publisher  
+ 1 numeric variable - NA_Sales


Questions to be answered
========================
Company A want to know the feasibility of an online game streaming platform similar to ‘Netflix’ for games. They would like to know how to design their initial portfolio on the platform to generate maximum revenue.  

+ Should Company A tie up with a single publisher or platform?  
+ Which 3 top performing games should they include in their portfolio  
+ How should their portfolio split be in terms of game genres

Functions
==========

```{r, warning= FALSE, message= FALSE }
# Function to get the relevant grouped data frames
# df -> dataframe
# groupVariable -> the group by column 
# output -> the resulting data frame
getGroupedUnivariateData <- function(df, groupVariable) {
  # group_by() store
  # summarise() reduces variable to descriptive stat
  # count is the new variable name, n() is a counting function
  # percent is a new variable, sum() and nrow() are functions
  # tot_sales_units -> total number of units sold per store
  # tot_revenue -> total revenue per store
  # order_by() tot_revenue and tot_sales_units
  result <- df %>%             
    group_by_(groupVariable) %>%     
    summarise(count = n(),   
              percent = (sum(count) / nrow(df)) * 100, 
              tot_revenue = sum(NA_Sales),   
              avg_revenue = (mean(NA_Sales))) %>%
    arrange(desc(tot_revenue)) %>%
    as.data.frame() 
  
  return(result)
}

# Function to draw histograms using grid.arrange so can see all quant variables together group by variable x
# df -> dataframe
# x -> the group by column 
getGroupedUnivariateHistograms <- function(df, x, flip = TRUE) {
  grid.arrange(
    df %>% 
      ggplot(aes(x = get(x), y = count)) +  
        geom_bar(stat = "identity") + 
        {if(flip)coord_flip()} +
        xlab(x),
    df %>% 
      ggplot(aes(x = get(x), y = tot_revenue)) +
        geom_bar(stat = "identity") + 
        {if(flip)coord_flip()} +
        xlab(x),
    df %>% 
      ggplot(aes(x = get(x), y = avg_revenue)) +
        geom_bar(stat = "identity") + 
        {if(flip)coord_flip()} +
        xlab(x),
    ncol = 2
  )
}


```

# I) Practical Analysis

1. Univariate non-graphical -- Categorical
===========================================

Categorical data - tabulation

### Platform

```{r, warning= FALSE, message= FALSE}
# Count and revenue by Platform
vg_platform <- getGroupedUnivariateData(video_games_data, "Platform")
vg_platform %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  scroll_box(height = "300px")
```
### Observations

+ Top 5 Platforms by Total Revenue are X360, PS2, Wii, PS3, DS  
+ Maximum number of games on PS2(1620) and DS(1512)

### Year

```{r, warning= FALSE, message= FALSE}
# Count and revenue by Year
vg_year <- getGroupedUnivariateData(video_games_data, "Year")
vg_year %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  scroll_box(height = "300px")
```
### Observations

+ Top Years by Revenue are 2008, 2009, 2007 
+ Maximum number of games launched between 2007 to 2009

### Genre

```{r, warning= FALSE, message= FALSE}
# Count and revenue by Genre
vg_genre <- getGroupedUnivariateData(video_games_data, "Genre")
vg_genre %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  scroll_box(height = "300px")
```
### Observations

+ Top 6 Genres are Action, Sports, Shooter, Misc, Role-Playing, Racing
+ The top 6 Genres make revenue more than 70% of the total genres

### Publisher 

```{r, warning= FALSE, message= FALSE}
# Count and revenue by Publisher
vg_publisher <- getGroupedUnivariateData(video_games_data, "Publisher")
vg_publisher %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  scroll_box(height = "300px")
```
### Observations

+ Top 5 Publishers are Electronic Arts, Nintendo, Activisions, Ubisoft, Take-Two Interactive   
+ Sony Computer Entertainment(406) and Konami Digital Entertainment(415) has more games but less Revenue than Nintendo and Take-Two Interactive


2. Univariate graphical -- Categorical
===========================================

Histograms

### Platform

```{r, warning= FALSE, message= FALSE }

# Revenue by Platform
getGroupedUnivariateHistograms(vg_platform, "Platform")

```
### Observations

+ PS2 has maximum games  
+ X360 has maximum total revenue  
+ GB has maximum average revenue but very few games. DC is also similar.  
+ Among others, X360 has maximum revenue


### Year

```{r, warning= FALSE, message= FALSE }

# Revenue by Year
getGroupedUnivariateHistograms(vg_year, "Year")

```
### Observations

+ Most games were released between 2006 to 2011 with 2008 being maximum  
+ Total Revenue is same pattern as number of games  
+ Maximum average revenue was in 2013


### Genre

```{r, warning= FALSE, message= FALSE }

# Revenue by Genre
getGroupedUnivariateHistograms(vg_genre, "Genre")

```
### Observations

+ Action Genre has the most number of games  
+ Action Genre has maximum total revenue   
+ Shooting Genre has maximum average revenue


### Publisher

```{r, warning= FALSE, message= FALSE }

# Revenue by Publisher
# Remove publishers who have less than 100 games
vg_publisher <- vg_publisher %>%
  filter(count >= 100)

getGroupedUnivariateHistograms(vg_publisher, "Publisher")

```
### Observations

+ Electronic Arts has most number of games  
+ Electronic Arts, Nintendo and Activision have most total revenue  
+ Nintendo has most average revenue followed by Microsoft


3. Univariate non-graphical -- Quantitative
============================================

Descriptive Statistics

```{r, warning=FALSE, message=FALSE}

# Get descriptive stats 
summary(video_games_data)

```

### Observations

+ Mean NA_Sales Revenue is 0.33 Millions  
+ Median NA_Sales is 0.13  
+ Therefore, the distribution is left skewed  
+ Maximum NA_Sales in 41.49 Million


4. Univariate graphical -- Quantitative
=========================================

Histograms

```{r, warning=FALSE, message=FALSE}
# Code histograms using ggplot() 
video_games_data %>% 
  ggplot(aes(NA_Sales)) +
  geom_histogram()

video_games_data %>% 
  ggplot(aes(NA_Sales)) +
  geom_histogram() +
  xlim(0,15)
```
### Observations

+ Most NA_Sales between 0 to 5 Million Dollars  
+ Few outliers around 40 Million Dollars

Boxplots

```{r, warning=FALSE, message=FALSE}
# Code boxplot
boxplot(video_games_data$NA_Sales, main = "NA_Sales(Millions")

```

### Observations same as histograms

5. Multivariate non-graphical -- Categorical
============================================

Cross-Tabs


Proportion Cross-Tabs


6. Multivariate graphical code -- Categorical
==============================================

Grouped Summary graphs with more than 1 Categorical variables



7. Multivariate non-graphical -- Quantitative
==============================================

Correlation plots


8. Multivariate graphical code -- Quantitative
===============================================

Pairwise Plot



9. Multivariate non-graphical -- Categorical and Quantitative
=============================================================

matrix tables


10. Multivariate graphical -- Categorical and Quantitative
=============================================================

matrix group by and summarize quant graphs


# II) Statistical Analysis


Questions for statistical analysis
=========================================



Multiple Linear regression
================================

Summary
=======


Save Image of file
===================

```{r, warning= FALSE, message= FALSE }

# Save the rds file to reuse anything from this file in another file
save.image("TA.RData")
# recover using load()
# load("TA.RData")

```





